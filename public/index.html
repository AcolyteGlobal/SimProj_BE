<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Local API Tester</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6">

  <div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Local API Tester</h1>

    <!-- GET Routes -->
    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">GET Routes</h2>
      <button onclick="fetchUsers()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 mr-2">Get Users</button>
      <button onclick="fetchAllUsers()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Get All Users</button>
    </div>

    <!-- POST /users -->
    <div class="mb-6 p-4 bg-white rounded shadow">
      <h2 class="text-xl font-semibold mb-2">POST /users (Create User)</h2>
      <div class="grid grid-cols-2 gap-3">
        <input type="text" id="userName" placeholder="Name" class="p-2 border rounded">
        <input type="text" id="userBranch" placeholder="Branch" class="p-2 border rounded">
        <input type="text" id="userOffice" placeholder="Office Number" class="p-2 border rounded">
        <input type="text" id="userDept" placeholder="Department" class="p-2 border rounded">
        <input type="text" id="userBio" placeholder="Biometric ID" class="p-2 border rounded">
        <input type="email" id="userEmail" placeholder="Official Email" class="p-2 border rounded">
      </div>
      <button onclick="createUser()" class="mt-3 px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Create User</button>
    </div>

    <!-- POST /assign -->
    <div class="mb-6 p-4 bg-white rounded shadow">
      <h2 class="text-xl font-semibold mb-2">POST /assign</h2>
      <input type="number" id="assignUserId" placeholder="User ID" class="p-2 border rounded mr-2">
      <input type="number" id="assignSimId" placeholder="SIM ID" class="p-2 border rounded mr-2">
      <button onclick="assignSim()" class="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700">Assign SIM</button>
    </div>

    <!-- POST /exit -->
    <div class="mb-6 p-4 bg-white rounded shadow">
      <h2 class="text-xl font-semibold mb-2">POST /exit</h2>
      <input type="number" id="exitUserId" placeholder="User ID" class="p-2 border rounded mr-2">
      <input type="text" id="exitReason" placeholder="Reason" class="p-2 border rounded mr-2">
      <input type="text" id="exitAdmin" placeholder="Admin Name" class="p-2 border rounded mr-2">
      <button onclick="exitUser()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Exit User</button>
    </div>

    <!-- Users Table -->
    <div class="overflow-x-auto rounded-lg shadow-lg bg-white">
      <table class="w-full text-sm text-left text-gray-600">
        <thead class="bg-gray-800 text-white">
          <tr>
            <th class="px-4 py-3">ID</th>
            <th class="px-4 py-3">Name</th>
            <th class="px-4 py-3">Branch</th>
            <th class="px-4 py-3">Office</th>
            <th class="px-4 py-3">Department</th>
            <th class="px-4 py-3">Biometric ID</th>
            <th class="px-4 py-3">Email</th>
            <th class="px-4 py-3">Status</th>
            <th class="px-4 py-3">Created</th>
            <th class="px-4 py-3">Updated</th>
          </tr>
        </thead>
        <tbody id="usersTableBody" class="bg-white divide-y divide-gray-200">
          <!-- Dynamic rows will appear here -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const tableBody = document.getElementById('usersTableBody');

    async function fetchUsers() {
      const res = await fetch('/users');
      const data = await res.json();
      populateTable(data);
    }

    async function fetchAllUsers() {
      const res = await fetch('/allUsers');
      const data = await res.json();
      populateTable(data);
    }

    async function createUser() {
      const name = document.getElementById('userName').value.trim();
      const branch = document.getElementById('userBranch').value.trim();
      const office_number = document.getElementById('userOffice').value.trim();
      const department = document.getElementById('userDept').value.trim();
      const biometric_id = document.getElementById('userBio').value.trim();
      const official_email = document.getElementById('userEmail').value.trim();

      if (!name || !branch || !office_number || !department || !biometric_id || !official_email) {
        alert('Please fill all required fields');
        return;
      }

      const res = await fetch('/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, branch, office_number, department, biometric_id, official_email })
      });
      const data = await res.json();
      populateTable([data]); // display created user
    }

    async function assignSim() {
      const user_id = parseInt(document.getElementById('assignUserId').value);
      const sim_id = parseInt(document.getElementById('assignSimId').value);

      if (!user_id || !sim_id) { alert('Please enter both User ID and SIM ID'); return; }

      const res = await fetch('/assign', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id, sim_id })
      });
      const data = await res.json();
      alert(JSON.stringify(data));
    }

    async function exitUser() {
      const user_id = parseInt(document.getElementById('exitUserId').value);
      const reason = document.getElementById('exitReason').value.trim();
      const admin = document.getElementById('exitAdmin').value.trim();

      if (!user_id || !reason || !admin) { alert('Please fill all exit fields'); return; }

      const res = await fetch('/exit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id, reason, admin })
      });
      const data = await res.json();
      alert(JSON.stringify(data));
    }

    function populateTable(users) {
      tableBody.innerHTML = '';
      users.forEach(user => {
        tableBody.innerHTML += `
          <tr>
            <td class="px-4 py-3">${user.user_id || user.id || '-'}</td>
            <td class="px-4 py-3 font-medium text-gray-900">${user.name || '-'}</td>
            <td class="px-4 py-3">${user.branch || '-'}</td>
            <td class="px-4 py-3">${user.office_number || '-'}</td>
            <td class="px-4 py-3">${user.department || '-'}</td>
            <td class="px-4 py-3">${user.biometric_id || '-'}</td>
            <td class="px-4 py-3">${user.official_email || '-'}</td>
            <td class="px-4 py-3">
              <span class="px-2 py-1 text-xs font-semibold rounded-full ${user.status === 'inactive' ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}">
                ${user.status || 'Active'}
              </span>
            </td>
            <td class="px-4 py-3">${user.created_at?.split('T')[0] || '-'}</td>
            <td class="px-4 py-3">${user.updated_at?.split('T')[0] || '-'}</td>
          </tr>
        `;
      });
    }
  </script>
</body>
</html>
